我们编写的java文件，从生到死的主要过程有：

1. 通过javac编译器编译为class文件
2. 通过类加载器加载到内存
3. JVM运行时优化
4. 垃圾回收

期间还涉及到Java内存模型。

所以这里按照顺序依次讲解，由于讲内存模型必然会讲到锁，所以锁也会在这里讲述，
Annotation也会在这里涉及

## javac编译器

编译过程：

1. 解析与填充符号表；
2. 处理注解；
3. 分析与字节码生成

### 解析与填充符号表

解析：包括了词法分析（将代码转化为Token合集）和语法分析（将Token合集转化为抽象语法树）

填充符号表：根据抽象语法树生成符号表（符号信息和符号地址组成的KV表格，一个统称，有常数表、变量名表、数组名表、过程名表、标号表等，用于语义分析和生成中间代码、生成目标代码）。

解析完成后就不会对源码进行操作了，后面基本都是根据抽象语法树来操作。

### 处理注解：

注解处理器可将其看做编译器的插件，在这些插件里面，可以读取、修改、添加抽象语法树中的任意元素，如果这些插件在处理注解期间对语法树进行了修改，编译器将回到解析及填充符号表的过程重新处理，直到所有插入式注解处理器都没有再对语法树进行修改为止。

### 分析与字节码生成

#### 语义分析

语义分析包含：
* 标注检查，
* 数据及控制流分析，
* 解语法糖

标注检查步骤检查的内容如变量使用前是否已经被声明、变量与赋值之间的数据类型是否匹配等。

数据及控制流分析是对程序上下文逻辑更进一步的验证，可以检查出诸如程序局部变量是否在使用前有赋值、方法的每条路径是否都有返回值、是否所有的受检异常都被正确处理等。

Java中常见的语法糖有：泛型、自动装箱、自动拆箱、变长参数、内部类、枚举类、字符串的switch支持等

#### 字节码生成

编译器会把语句块、变量初始化、调用父类的实例构造器等操作收敛到<init>()或<clinit>()方法之中，并且保证一定是先执行父类的实例构造器。 完成了对语法树的遍历和调整之后，就会把填充了所有所需信息的符号表交给ClassWriter类，由这个类的writeClass()方法输出字节码，生成最终的Class文件

